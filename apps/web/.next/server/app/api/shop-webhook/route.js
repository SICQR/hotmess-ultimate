(()=>{var e={};e.id=1623,e.ids=[1623],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},63031:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>u});var o=r(52412),a=r(14293),n=r(94147),i=r(91423);async function u(e){try{let t=await e.json();if(e.headers.get("x-webhook-signature")!==process.env.WEBHOOK_SECRET)return Response.json({error:"Invalid signature"},{status:401});let{event:r,ref_code:s,amount:o,product_name:a,customer_email:n,order_id:u,user_id:l}=t;if(!s)return Response.json({error:"Reference code required"},{status:400});return await (0,i.F2)({ref_code:s,user_id:l,event:r,amount:o?parseFloat(o):void 0,product:a,metadata:{customer_email:n,order_id:u,timestamp:new Date().toISOString()}}),Response.json({success:!0,message:"Referral tracked successfully"})}catch(e){return console.error("Shop webhook error:",e),Response.json({error:"Internal server error"},{status:500})}}async function l(){return Response.json({message:"HOTMESS Shop Webhook Endpoint",timestamp:new Date().toISOString(),version:"1.0"})}let c=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/shop-webhook/route",pathname:"/api/shop-webhook",filename:"route",bundlePath:"app/api/shop-webhook/route"},resolvedPagePath:"/home/runner/work/hotmess-ultimate/hotmess-ultimate/apps/web/app/api/shop-webhook/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:d,serverHooks:m}=c;function h(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:d})}},35303:()=>{},91423:(e,t,r)=>{"use strict";r.d(t,{F2:()=>n,eW:()=>i});var s=r(73242),o=r(37191);let a=(0,s.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);async function n(e){try{let{data:t,error:r}=await a.from("referrals").insert({ref_code:e.ref_code,user_id:e.user_id,event:e.event,amount:e.amount,product:e.product,metadata:e.metadata}).select().single();if(r)throw console.error("Error tracking referral:",r),r;return"sale"===e.event&&e.amount&&await (0,o.F)("sale",{ref:e.ref_code,amount:e.amount,product:e.product||"Unknown"}),await u(e.ref_code),t}catch(e){throw console.error("Failed to track referral:",e),e}}async function i(e){try{let{data:t,error:r}=await a.from("referrals").select("*").eq("ref_code",e);if(r)throw r;let s=t.filter(e=>"sale"===e.event&&e.amount).reduce((e,t)=>e+(t.amount||0),0),o=t.length,n=t.filter(e=>"sale"===e.event).length/Math.max(t.filter(e=>"click"===e.event).length,1);return{totalSales:s,totalReferrals:o,conversionRate:Math.round(100*n),recentEvents:t.slice(-10)}}catch(e){throw console.error("Failed to get affiliate stats:",e),e}}async function u(e){try{let t=await i(e);for(let r of[{threshold:100,name:"First \xa3100 in sales"},{threshold:500,name:"\xa3500 sales milestone"},{threshold:1e3,name:"\xa31000 sales milestone"},{threshold:5e3,name:"\xa35000 VIP status"}])if(t.totalSales>=r.threshold){let{data:s}=await a.from("milestone_notifications").select("*").eq("ref_code",e).eq("milestone",r.threshold).single();s||(await (0,o.F)("milestone",{ref:e,milestone:r.name,total:t.totalSales}),await a.from("milestone_notifications").insert({ref_code:e,milestone:r.threshold,sent_at:new Date().toISOString()}))}}catch(e){console.error("Failed to check milestones:",e)}}},37191:(e,t,r)=>{"use strict";async function s(e,t="info"){let r=process.env.TELEGRAM_BOT_TOKEN,o=process.env.NEXT_PUBLIC_TG_ANNOUNCE_CHANNEL;if(!r||!o){console.warn("Telegram bot not configured - missing token or chat ID");return}let a="ℹ️";"sale"===t&&(a="\uD83D\uDCB8"),"payout"===t&&(a="\uD83D\uDCB0"),"leaderboard"===t&&(a="\uD83C\uDFC6"),"signup"===t&&(a="\uD83C\uDD95"),"milestone"===t&&(a="\uD83C\uDFAF");let n=`${a} HOTMESS ${t.toUpperCase()}

${e}`;try{let e=await fetch(`https://api.telegram.org/bot${r}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,text:n,parse_mode:"Markdown",disable_web_page_preview:!0})});if(!e.ok)throw Error(`Telegram API error: ${e.status}`);let t=await e.json();return console.log("Telegram message sent successfully:",t),t}catch(e){throw console.error("Failed to send Telegram message:",e),e}}async function o(e,t){let r="";switch(e){case"sale":r=`🛍️ **SALE TRACKED**
Affiliate: \`${t.ref}\`
Amount: \xa3${t.amount}
Product: ${t.product}`;break;case"payout":r=`💰 **PAYOUT PROCESSED**
Affiliate: \`${t.ref}\`
Amount: \xa3${t.amount}
Status: ${t.status}`;break;case"milestone":r=`🎯 **MILESTONE REACHED**
Affiliate: \`${t.ref}\`
Achievement: ${t.milestone}
Total Sales: \xa3${t.total}`}return s(r,e)}r.d(t,{F:()=>o,T:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4147,9971],()=>r(63031));module.exports=s})();