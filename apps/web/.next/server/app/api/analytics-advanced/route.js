(()=>{var e={};e.id=1135,e.ids=[1135],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},9718:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>c});var a=r(52412),n=r(14293),i=r(94147);let o=(0,r(73242).eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function u(){try{let{data:e,error:t}=await o.from("analytics").select(`
        *,
        users!inner(*),
        sessions!inner(*)
      `).gte("created_at",new Date(Date.now()-6048e5).toISOString());if(t)throw t;let r=e.length,s=e.reduce((e,t)=>e+(t.sessions?.duration||0),0)/r,a=e.flatMap(e=>e.genres||[]).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),n={dailyActiveUsers:r,averageSessionDuration:Math.round(s/60),topGenres:Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>({genre:e,count:t})),retentionRate:Math.round(r/1e3*100)};return Response.json({success:!0,data:n,timestamp:new Date().toISOString()})}catch(e){return console.error("Analytics error:",e),Response.json({error:"Failed to fetch analytics"},{status:500})}}async function c(e){try{let{userId:t,event:r,metadata:s}=await e.json(),{data:a,error:n}=await o.from("analytics").insert({user_id:t,event_type:r,metadata:s||{},timestamp:new Date().toISOString(),ip_address:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),user_agent:e.headers.get("user-agent")});if(n)throw n;return Response.json({success:!0,message:"Event tracked successfully"})}catch(e){return console.error("Event tracking error:",e),Response.json({error:"Failed to track event"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analytics-advanced/route",pathname:"/api/analytics-advanced",filename:"route",bundlePath:"app/api/analytics-advanced/route"},resolvedPagePath:"/home/runner/work/hotmess-ultimate/hotmess-ultimate/apps/web/app/api/analytics-advanced/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:x}=p;function m(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},35303:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4147,9971],()=>r(9718));module.exports=s})();