(()=>{var e={};e.id=6585,e.ids=[6585],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},63296:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>p,serverHooks:()=>d,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>u});var o=r(52412),a=r(14293),n=r(94147);let i=(0,r(73242).eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);async function u(e){try{let t=e.nextUrl.searchParams.get("ref");if(!t)return Response.json({error:"Reference code required"},{status:400});let{data:r,error:s}=await i.from("referrals").select("amount, created_at").eq("ref_code",t).eq("event","sale").order("created_at",{ascending:!1});if(s)return console.error("Sales data error:",s),Response.json({error:"Database error"},{status:500});let o=new Map;r?.forEach(e=>{let t=new Date(e.created_at),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;o.has(r)||o.set(r,{month:r,sales:0,commission:0,status:"pending"});let s=o.get(r);s.sales+=e.amount||0,s.commission+=.15*(e.amount||0)});let a=Array.from(o.values()).map(e=>{let t=new Date(e.month+"-15"),r=(new Date().getTime()-t.getTime())/864e5;return{...e,status:r>30?"paid":"pending",payout_date:r>30?new Date(t.getTime()+2592e6).toISOString():null,payment_method:"PayPal",transaction_id:r>30?`HM_${e.month.replace("-","")}_${Math.random().toString(36).substr(2,8).toUpperCase()}`:null}}).sort((e,t)=>t.month.localeCompare(e.month)),n=a.filter(e=>"paid"===e.status).reduce((e,t)=>e+t.commission,0),u=a.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.commission,0);return Response.json({payouts:a,summary:{total_paid:n,total_pending:u,total_commission:n+u,commission_rate:15,next_payout_date:function(){let e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,15).toISOString()}()}})}catch(e){return console.error("Payout history API error:",e),Response.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/payout-history/route",pathname:"/api/payout-history",filename:"route",bundlePath:"app/api/payout-history/route"},resolvedPagePath:"/home/runner/work/hotmess-ultimate/hotmess-ultimate/apps/web/app/api/payout-history/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:l,serverHooks:d}=p;function m(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:l})}},35303:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4147,9971],()=>r(63296));module.exports=s})();