(()=>{var e={};e.id=4945,e.ids=[4945],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},21675:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>p});var s={};r.r(s),r.d(s,{GET:()=>u});var a=r(52412),o=r(14293),i=r(94147),n=r(73242),l=r(91423);let c=(0,n.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);async function u(e){try{var t,r;let s=e.nextUrl.searchParams.get("ref");if(!s)return Response.json({error:"Reference code required"},{status:400});let{data:a,error:o}=await c.from("affiliate_codes").select("*").eq("ref_code",s).single();if(o||!a)return Response.json({error:"Affiliate not found"},{status:404});let i=await (0,l.eW)(s),{data:n,error:u}=await c.from("referrals").select("*").eq("ref_code",s).order("created_at",{ascending:!1}).limit(20);u&&console.error("Activity fetch error:",u);let d=.15*i.totalSales,{data:f,error:p}=await c.from("referrals").select("amount, created_at").eq("ref_code",s).eq("event","sale").order("created_at",{ascending:!0}),m=[];if(f&&!p){let e=new Map;f.forEach(t=>{let r=new Date(t.created_at).toISOString().slice(0,7);e.set(r,(e.get(r)||0)+(t.amount||0))}),m=Array.from(e.entries()).map(([e,t])=>({month:e,sales:t,commission:.15*t}))}return Response.json({affiliate:{ref_code:s,created_at:a.created_at,user_id:a.user_id},stats:i,commission:{total:d,pending:d,paid:0,rate:15},recentActivity:n||[],monthlyBreakdown:m,performance:{tier:(t=i.totalSales)>=5e3?"VIP":t>=1e3?"Gold":t>=500?"Silver":t>=100?"Bronze":"Starter",nextTierThreshold:(r=i.totalSales)<100?100:r<500?500:r<1e3?1e3:r<5e3?5e3:null}})}catch(e){return console.error("My affiliate API error:",e),Response.json({error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/my-affiliate/route",pathname:"/api/my-affiliate",filename:"route",bundlePath:"app/api/my-affiliate/route"},resolvedPagePath:"/home/runner/work/hotmess-ultimate/hotmess-ultimate/apps/web/app/api/my-affiliate/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:p,serverHooks:m}=d;function h(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:p})}},35303:()=>{},91423:(e,t,r)=>{"use strict";r.d(t,{F2:()=>i,eW:()=>n});var s=r(73242),a=r(37191);let o=(0,s.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);async function i(e){try{let{data:t,error:r}=await o.from("referrals").insert({ref_code:e.ref_code,user_id:e.user_id,event:e.event,amount:e.amount,product:e.product,metadata:e.metadata}).select().single();if(r)throw console.error("Error tracking referral:",r),r;return"sale"===e.event&&e.amount&&await (0,a.F)("sale",{ref:e.ref_code,amount:e.amount,product:e.product||"Unknown"}),await l(e.ref_code),t}catch(e){throw console.error("Failed to track referral:",e),e}}async function n(e){try{let{data:t,error:r}=await o.from("referrals").select("*").eq("ref_code",e);if(r)throw r;let s=t.filter(e=>"sale"===e.event&&e.amount).reduce((e,t)=>e+(t.amount||0),0),a=t.length,i=t.filter(e=>"sale"===e.event).length/Math.max(t.filter(e=>"click"===e.event).length,1);return{totalSales:s,totalReferrals:a,conversionRate:Math.round(100*i),recentEvents:t.slice(-10)}}catch(e){throw console.error("Failed to get affiliate stats:",e),e}}async function l(e){try{let t=await n(e);for(let r of[{threshold:100,name:"First \xa3100 in sales"},{threshold:500,name:"\xa3500 sales milestone"},{threshold:1e3,name:"\xa31000 sales milestone"},{threshold:5e3,name:"\xa35000 VIP status"}])if(t.totalSales>=r.threshold){let{data:s}=await o.from("milestone_notifications").select("*").eq("ref_code",e).eq("milestone",r.threshold).single();s||(await (0,a.F)("milestone",{ref:e,milestone:r.name,total:t.totalSales}),await o.from("milestone_notifications").insert({ref_code:e,milestone:r.threshold,sent_at:new Date().toISOString()}))}}catch(e){console.error("Failed to check milestones:",e)}}},37191:(e,t,r)=>{"use strict";async function s(e,t="info"){let r=process.env.TELEGRAM_BOT_TOKEN,a=process.env.NEXT_PUBLIC_TG_ANNOUNCE_CHANNEL;if(!r||!a){console.warn("Telegram bot not configured - missing token or chat ID");return}let o="ℹ️";"sale"===t&&(o="\uD83D\uDCB8"),"payout"===t&&(o="\uD83D\uDCB0"),"leaderboard"===t&&(o="\uD83C\uDFC6"),"signup"===t&&(o="\uD83C\uDD95"),"milestone"===t&&(o="\uD83C\uDFAF");let i=`${o} HOTMESS ${t.toUpperCase()}

${e}`;try{let e=await fetch(`https://api.telegram.org/bot${r}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:a,text:i,parse_mode:"Markdown",disable_web_page_preview:!0})});if(!e.ok)throw Error(`Telegram API error: ${e.status}`);let t=await e.json();return console.log("Telegram message sent successfully:",t),t}catch(e){throw console.error("Failed to send Telegram message:",e),e}}async function a(e,t){let r="";switch(e){case"sale":r=`🛍️ **SALE TRACKED**
Affiliate: \`${t.ref}\`
Amount: \xa3${t.amount}
Product: ${t.product}`;break;case"payout":r=`💰 **PAYOUT PROCESSED**
Affiliate: \`${t.ref}\`
Amount: \xa3${t.amount}
Status: ${t.status}`;break;case"milestone":r=`🎯 **MILESTONE REACHED**
Affiliate: \`${t.ref}\`
Achievement: ${t.milestone}
Total Sales: \xa3${t.total}`}return s(r,e)}r.d(t,{F:()=>a,T:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4147,9971],()=>r(21675));module.exports=s})();